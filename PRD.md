# 悬浮球待办事项软件 PRD（Product Requirement Document）
技术栈：Python（后端） + PyQt（前端）
产品代号：FloatDo（暂定）

---

# 一、产品背景 & 目标

## 1.1 背景

当前用户（尤其是开发者/高频电脑使用者）在工作时：

* 不希望打开完整的待办软件（如Notion/Todoist）
* 需要一个“随时可见但不打扰”的提醒工具
* 希望快速记录任务（1秒捕获想法）
* 不想切换窗口影响专注

悬浮球是非常契合的产品形态。

## 1.2 产品目标

打造一个：

* 常驻桌面
* 极简输入
* 高效率管理待办
* 低打扰、高可见性
  的悬浮球待办事项软件（桌面级）

---

# 二、核心功能描述（Functional Description）

## 2.1 核心功能模块

### 1）悬浮球（核心入口）

* 桌面常驻悬浮球
* 可拖拽移动
* 吸附屏幕边缘
* 点击展开待办面板
* 右键显示快捷菜单

---

### 2）待办事项管理

基础CRUD功能：

* 新建待办
* 编辑待办
* 删除待办
* 标记完成
* 设置优先级（高/中/低）
* 设置提醒时间（可选）

---

### 3）快速输入（高优先级功能）

支持：

* 单行快速输入
* 回车立即创建任务
* Ctrl+N 快捷创建

---

### 4）分类与筛选（V1可简化）

* 今日待办
* 已完成
* 全部任务

---

### 5）数据持久化（后端）

Python负责：

* 本地SQLite存储
* JSON配置管理
* 自动保存

---

# 三、用户使用流程（User Flow）

## 3.1 首次启动流程

```
启动程序
   ↓
桌面出现悬浮球（右下角）
   ↓
用户点击悬浮球
   ↓
展开待办面板
   ↓
输入第一条待办
   ↓
自动保存
```

---

## 3.2 日常使用流程（核心路径）

### 场景1：快速记录任务

```
看到任务
↓
点击悬浮球
↓
输入内容
↓
按Enter
↓
任务加入列表（动画插入）
```

---

### 场景2：完成任务

```
打开面板
↓
点击复选框
↓
任务变灰 + 划线
↓
自动归类到已完成
```

---

### 场景3：最小打扰模式

```
工作中
↓
悬浮球半透明
↓
悬停时高亮
↓
点击展开
```

---

# 四、页面逻辑（Page Logic）

## 4.1 页面结构总览

```
[悬浮球主入口]
      ↓
[待办面板窗口]
 ├── 输入区
 ├── 今日待办列表
 ├── 已完成折叠区
 └── 设置按钮
```

---

## 4.2 悬浮球逻辑

状态机：

```
Idle（悬浮）
Hover（高亮）
Click（展开面板）
Drag（拖拽）
Dock（吸附边缘）
```

---

## 4.3 待办面板逻辑（PyQt窗口）

组件结构：

* QLineEdit：输入框
* QListWidget：任务列表
* QPushButton：设置/筛选
* QCheckBox：完成状态

---

# 五、原型图 / 交互稿（给前端/UI）

## 5.1 界面草图（核心）

### ① 悬浮球（默认态）

```
     ○  （半透明圆形）
   直径：60px
   位置：屏幕右下角
```

---

### ② 展开面板（主界面）

```
┌────────────────────┐
│  📝 今日待办        ⚙ │
├────────────────────┤
│ [ + 输入新任务...... ] │  ← 输入框
├────────────────────┤
│ ☐ 完成PRD文档       │
│ ☐ 修复打包问题      │
│ ☑ 测试语音模块      │
├────────────────────┤
│ ▼ 已完成 (3)        │
└────────────────────┘
```

---

# 六、按钮位置（UI详细规范）

## 6.1 悬浮球

* 位置：默认右下角（可拖动）
* 大小：50~70px
* 透明度：70%
* 悬停透明度：100%

---

## 6.2 面板按钮布局

| 元素    | 位置  | 说明     |
| ----- | --- | ------ |
| 输入框   | 顶部  | 快速添加任务 |
| 设置按钮⚙ | 右上角 | 打开设置   |
| 任务列表  | 中间  | 核心区域   |
| 完成区折叠 | 底部  | 可展开    |

---

# 七、动画逻辑（Animation Logic）

## 7.1 悬浮球动画

* 鼠标悬停：轻微放大（1.1倍）
* 点击：弹性缩放（0.95 → 1.0）
* 拖拽：跟随鼠标平滑移动

（PyQt建议：QPropertyAnimation）

---

## 7.2 面板动画

展开动画：

```
悬浮球位置 → 平滑展开面板（200ms）
透明度：0 → 1
缩放：0.8 → 1.0
```

收起动画：

```
面板 → 收缩回悬浮球
```

---

## 7.3 任务交互动画

* 新任务：从上方滑入
* 完成任务：变灰 + 划线动画
* 删除：右滑消失（可选）

---

# 八、异常情况设计（Edge Cases）

## 8.1 程序异常

| 异常       | 处理方案        |
| -------- | ----------- |
| 数据库损坏    | 自动重建 + 备份恢复 |
| 后端未启动    | 弹出错误提示      |
| JSON配置错误 | 使用默认配置      |
| PyQt崩溃   | 自动重启进程（高级）  |

---

## 8.2 用户行为异常

| 行为     | 处理        |
| ------ | --------- |
| 输入空任务  | 禁止创建 + 提示 |
| 超长文本   | 自动换行      |
| 重复任务   | 允许（不限制）   |
| 快速连续点击 | 防抖处理      |

---

## 8.3 系统级异常（结合你当前项目经验）

（非常关键）

* 端口占用（8000）
* WinError 10022
* 后端超时未启动

解决：

* 后端健康检查 `/health`
* 启动超时10秒自动重试

---

# 九、验收标准（Acceptance Criteria）

## 9.1 功能验收

| 功能   | 验收标准         |
| ---- | ------------ |
| 悬浮球  | 可拖拽、吸附、点击展开  |
| 新建任务 | 1秒内创建成功      |
| 数据保存 | 重启后不丢失       |
| 完成任务 | 状态正确持久化      |
| UI响应 | 操作延迟 < 100ms |

---

## 9.2 性能标准

* 内存占用 < 150MB
* 启动时间 < 3秒
* CPU占用（空闲） < 3%

（考虑你要打包成exe给普通用户）

---

# 十、需求拆解（开发任务列表）

# 🚀 Epic 1：基础框架

### 后端（Python）

* [x] 搭建FastAPI服务
* [x] SQLite数据库设计 (使用JSON实现)
* [x] Task数据模型（CRUD）
* [x] 本地API接口（/tasks）

---

# 🎨 Epic 2：PyQt前端（核心）

## 悬浮球模块

* [x] 创建无边框窗口
* [x] 实现悬浮置顶（AlwaysOnTop）
* [x] 拖拽移动逻辑
* [x] 边缘吸附算法
* [x] 悬停动画（QPropertyAnimation）

---

## 待办面板模块

* [x] 面板窗口UI
* [x] 输入框组件
* [x] 任务列表组件（QListWidget）
* [x] 复选框交互逻辑
* [x] 折叠已完成区域

---

# 🧠 Epic 3：交互逻辑

* [x] 点击悬浮球展开面板
* [x] Enter快速创建任务
* [x] 勾选完成动画
* [x] 删除任务逻辑 (带淡出动画)
* [x] 实时刷新UI状态 (每2秒轮询)

---

# 💾 Epic 4：数据层（关键）

（结合你现在voice_assistant的本地架构，非常适合）

* [ ] 本地SQLite封装
* [ ] 自动保存机制
* [ ] 启动加载任务
* [ ] 异常恢复机制

---

# ⚙️ Epic 5：系统级功能（高级，建议你后期做）

* [ ] 开机自启动
* [ ] 打包EXE（Nuitka）
* [ ] 托盘图标（QSystemTrayIcon）
* [ ] 无终端运行（pythonw）

---
